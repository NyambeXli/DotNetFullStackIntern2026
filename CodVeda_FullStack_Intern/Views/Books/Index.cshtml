//Inex
@model IEnumerable<CodVeda_FullStack_Intern.Models.Book>
@using Microsoft.AspNetCore.Http

@{
    ViewData["Title"] = "Library Catalog";
    var userName = Context.Session.GetString("UserName");
    var isLoggedIn = userName != null;
    var isAdmin = userName == "System Admin";
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Available Books</h2>
        @if (isAdmin)
        {
            <div class="d-flex align-items-center gap-3">
                <a asp-action="Create" class="btn btn-success fw-bold shadow-sm">+ Add New Book</a>
                <span class="badge bg-danger p-2">Admin Mode Active</span>
            </div>
        }
    </div>

    <div class="row">
        @foreach (var book in Model)
        {
            <div class="col-md-4 mb-4">
                <div class="card shadow-sm h-100 @(book.IsHidden ? "border-warning opacity-75" : "")">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start">
                            <h4 class="card-title text-primary">@book.Title</h4>
                            @if (book.IsHidden)
                            {
                                <span class="badge bg-warning text-dark">Hidden</span>
                            }
                        </div>
                        <hr />

                        @if (isLoggedIn)
                        {
                            <p><strong>Publisher:</strong> @book.Publisher</p>
                            <p><strong>Published:</strong> @book.PublishDate</p>
                            <p class="text-muted" style="font-size: 0.9rem;">@book.Summary</p>

                            @if (isAdmin)
                            {
                                <div class="mt-3 pt-2 border-top d-flex gap-1 flex-wrap">
                                    <a asp-action="Edit" asp-route-id="@book.Id" class="btn btn-sm btn-warning">Update</a>

                                    <a asp-action="ToggleHide" asp-route-id="@book.Id" class="btn btn-sm btn-secondary">
                                        @(book.IsHidden ? "Unhide" : "Hide")
                                    </a>

                                    <form asp-action="Delete" asp-route-id="@book.Id" method="post" onsubmit="return confirm('Delete this book permanently?');" style="display:inline;">
                                        <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                                    </form>
                                </div>
                            }
                        }
                        else
                        {
                            <div class="bg-light p-3 rounded text-center">
                                <p class="text-secondary small italic">Details are restricted to registered users.</p>
                                <a asp-controller="Account" asp-action="Register" class="btn btn-sm btn-outline-primary">Register to View Details</a>
                            </div>
                        }
                    </div>
                </div>
            </div>
        }
    </div>
</div>
